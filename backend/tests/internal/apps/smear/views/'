import pytest

from rest_framework.reverse import reverse
from rest_framework import status

from apps.smear.serializers import GameSerializer
from tests.internal.apps.smear.factories import GameFactory


@pytest.mark.django_db
def test_game_viewset_list(authed_client):
    games = [GameFactory() for i in range(3)]
    url = reverse('games-list')
    client = authed_client(games[0].owner)

    response = client.get(url)

    assert response.status_code == status.HTTP_200_OK
    assert response.json() == {
        'count': 3,
        'next': None,
        'previous': None,
        'results': [GameSerializer(game).data for game in games],
    }
